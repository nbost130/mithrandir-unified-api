name: ðŸ”® Mithrandir Unified API CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  test:
    name: Test & Build
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ðŸ“¦ Setup Bun
      uses: oven-sh/setup-bun@v2
      with:
        bun-version: latest

    - name: ðŸ“¥ Install dependencies
      run: bun install

    - name: ðŸ”¨ Build TypeScript
      run: bun run build

    - name: âœ… Verify build artifacts
      run: |
        ls -la dist/
        test -f dist/index.js || (echo "âŒ Build failed: dist/index.js not found" && exit 1)
        test -f dist/server.js || (echo "âŒ Build failed: dist/server.js not found" && exit 1)
        echo "âœ… Build artifacts verified"

    - name: ðŸ“Š CI Summary
      if: always()
      run: |
        echo "### ðŸ”® CI Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- **Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Status:** ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
